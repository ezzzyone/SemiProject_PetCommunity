<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pet.home.sell.check.CheckDAO">
	
		
	<insert id="setCheck" parameterType="CheckDTO">
		INSERT INTO PURCHASE 
		VALUES 
		(#{imp_uid}, #{merchant_uid}, #{itemNum}, #{amount}, #{userId}, #{revStartDate}, #{revEndDate}, #{adultsCount}, #{dogCount}, sysdate)
	</insert>
	
	<select id="getPurchaseList" parameterType="String" resultMap="getPurchaseListResult">
		SELECT  P.merchant_uid, P.IMP_UID, M.EMAIL, M.PHONE, SI.USERID, SI.ITEMNAME FROM 
		PURCHASE P
			RIGHT JOIN
			MEMBER M
			ON P.USERID = M.USERID
				RIGHT JOIN
				SELLITEM SI
				ON P.ITEMNUM = SI.ITEMNUM
		WHERE P.USERID = #{userId}
		ORDER BY P.PURCHASEDATE DESC
	</select>
	
	<select id="getPurchaseDetail" parameterType="CheckDTO" resultMap="getPurchaseListResult">
		SELECT  P.*, M.USERNAME, M.EMAIL, M.PHONE, SI.USERID, SI.ITEMNAME FROM 
		PURCHASE P
			RIGHT JOIN
			MEMBER M
			ON P.USERID = M.USERID
				RIGHT JOIN
				SELLITEM SI
				ON P.ITEMNUM = SI.ITEMNUM
		WHERE P.MERCHANT_UID = #{merchant_uid}
		ORDER BY P.PURCHASEDATE DESC
	</select>
	
	<delete id="setPurchaseDelete">
		DELETE PURCHASE WHERE IMP_UID = #{imp_uid}
	</delete>
	
	<resultMap type="CheckDTO" id="getPurchaseListResult">
		<id column="IMP_UID" property="imp_uid"/>
				<result column="MERCHANT_UID" property="merchant_uid"/>
				<result column="ITEMNUM" property="itemNum"/>
				<result column="AMOUNT" property="amount"/>
				<result column="USERID" property="userId"/>
				<result column="REVSTARTDATE" property="revStartDate"/>
				<result column="REVENDDATE" property="revEndDate"/>
				<result column="ADULTSCOUNT" property="adultsCount"/>
				<result column="DOGCOUNT" property="dogCount"/>
				<result column="PURCHASEDATE" property="purchaseDate"/>
			<association property="itemDTO" javaType="SellItemDTO">
				<id column="ITEMNUM" property="itemNum"/>
				<result column="USERID" property="userId"/>
				<result column="ITEMNAME" property="itemName"/>
				<result column="ITEMPRICE" property="itemPrice"/>
				<result column="ITEMCONTENTS" property="itemContents"/>
				<result column="ITEMZIPCODE" property="itemZipCode"/>
				<result column="ITEMADDRESS" property="itemAddress"/>
				<result column="ITEMDEADDRESS" property="itemDeAddress"/>
				<result column="ITEMCATG" property="itemCatg"/>
				</association>
			<association property="memberDTO" javaType="MemberDTO">
				<id column="USERID" property="userId"/>
				<result column="USERNAME" property="userName"/>
				<result column="EMAIL" property="email"/>
				<result column="PHONE" property="phone"/>
				</association>
	</resultMap>
	
</mapper>