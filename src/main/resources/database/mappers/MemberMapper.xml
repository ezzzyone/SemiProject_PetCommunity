<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		    "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
		    
		 <mapper namespace="com.pet.home.member.MemberDAO">

<insert id="setJoin" parameterType="MemberDTO">	 
INSERT INTO member (USERID,ROLENUM,USERNAME,PASSWORD,EMAIL,PHONE,ADDRESS,BLOCK,AGMAIL,AGVALUE,AGMES)
VALUES (#{userId},#{roleNum},#{userName},#{password},#{email},#{phone},#{address},0,#{agMail},#{agValue},#{agMes})

</insert>

<insert id="setGuest" parameterType="MemberDTO">	 
INSERT INTO GUEST (GUESTID,USERID,ROLENUM,PETCATG,PETNAME)
VALUES (#{guestId},#{userId},#{roleNum},#{petCatg},#{petName})
</insert>

<insert id="setBiz" parameterType="MemberDTO">	 
INSERT INTO BIZMEM (BIZNUM,USERID,ROLENUM,ITEMCATG,ITEMID)
VALUES (#{bizNum},#{userId},#{roleNum},#{itemCatg},ITEM_SEQ.NEXTVAL)
</insert>

			 
		 	 
<select id="getLogin" parameterType="MemberDTO" resultMap="getLoginResult">
SELECT M.USERNAME, M.USERID, R.ROLENUM, R.ROLENAME
		FROM MEMBER M
    		INNER JOIN
    		ROLE R
    		ON M.ROLENUM = R.ROLENUM
		WHERE M.USERID =#{userId} and M.PASSWORD =#{password}
		ORDER BY R.ROLENUM ASC
</select>

<resultMap type="MemberDTO" id="getLoginResult">
		<id column="USERID" property="userId" />
		<result column="USERNAME" property="userName" />
		<collection property="roleDTOs" javaType="List" ofType="RoleDTO">
			<id column="ROLENUM" property="roleNum" />
			<result column="ROLENAME" property="roleName" />
		</collection>
	</resultMap>
	
<select id="getPickList" parameterType="MemberDTO" resultMap="getPickListResult">
SELECT M.USERID,P.PICKNUM,SI.ITEMNUM,SI.ITEMNAME,SI.ITEMPRICE,SI.ITEMCONTENTS,SF.FILENAME
FROM MEMBER M
     INNER JOIN
     PICK P
     ON M.USERID = P.USERID
     INNER JOIN
     SELLITEM SI
     ON P.ITEMNUM = SI.ITEMNUM
     INNER JOIN
     SELLFILE SF
     ON SI.ITEMNUM = SF.ITEMNUM
WHERE M.USERID = 'guest' ORDER BY P.PICKNUM DESC
</select>
<resultMap type="MemberDTO" id="getPickListResult">
	<id column="USERID" property="userId"/>
	<collection property="itemDTOs" javaType="List" ofType="SellItemDTO">
		<id column="ITEMNUM" property="itemNum"/>
		<result column="ITEMNAME" property="itemName"/>
		<result column="ITEMPRICE" property="itemPrice"/>
		<result column="ITEMCONTENTS" property="itemContents"/>
		<collection property="fileDTOs" javaType="List" ofType="sellFileDTO">
			<result column="FILENAME" property="fileName"/>
		</collection>
	</collection>
</resultMap>

<select id="getShopCartList" parameterType="MemberDTO" resultMap="getShopCartListResult">
SELECT M.USERID,S.SHOPNUM,S.TOTALCOUNT,SI.ITEMNUM,SI.ITEMNAME,SI.ITEMPRICE,SI.ITEMCONTENTS,SF.FILENAME
FROM MEMBER M
     INNER JOIN
     SHOPCART S
     ON M.USERID = S.USERID
     INNER JOIN
     SELLITEM SI
     ON S.ITEMNUM = SI.ITEMNUM
     INNER JOIN
     SELLFILE SF
     ON SI.ITEMNUM = SF.ITEMNUM
WHERE M.USERID = 'guest' ORDER BY S.SHOPNUM DESC
</select>
<resultMap type="MemberDTO" id="getShopCartListResult">
	<id column="USERID" property="userId"/>
	<collection property="itemDTOs" javaType="List" ofType="SellItemDTO">
		<id column="ITEMNUM" property="itemNum"/>
		<result column="ITEMNAME" property="itemName"/>
		<result column="ITEMPRICE" property="itemPrice"/>
		<result column="ITEMCONTENTS" property="itemContents"/>
		<collection property="shopCartDTOs" javaType="List" ofType="ShopCartDTO">
		<result column="TOTALCOUNT" property="totalCount"/>
		</collection>
		<collection property="fileDTOs" javaType="List" ofType="sellFileDTO">
			<result column="FILENAME" property="fileName"/>
		</collection>
	</collection>
</resultMap>

<select id="getTotalPrice" parameterType="MemberDTO" resultType="MemberDTO">
SELECT SUM(S.TOTALPRICE*S.TOTALCOUNT) AS TOTALPRICE
FROM MEMBER M
     INNER JOIN
     SHOPCART S
     ON M.USERID = S.USERID
WHERE M.USERID = 'guest'
</select>

</mapper>