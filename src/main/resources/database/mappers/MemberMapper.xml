<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		    "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
		    
		 <mapper namespace="com.pet.home.member.MemberDAO">

<insert id="setJoin" parameterType="MemberDTO">	 
INSERT INTO member (USERID,ROLENUM,USERNAME,PASSWORD,EMAIL,PHONE,ADDRESS,BLOCK,AGMAIL,AGVALUE,AGMES)
VALUES (#{userId},#{roleNum},#{userName},#{password},#{email},#{phone},#{address},0,#{agMail},#{agValue},#{agMes})
</insert>

<insert id="setAddFile" parameterType="MemberFileDTO">
INSERT INTO MEMFILE (FILENUM,FILENAME,ORINAME,USERID)
VALUES (file_seq.NEXTVAL,#{fileName},#{oriName},#{userId})
</insert>

<insert id="setGuest" parameterType="MemberDTO">	 
INSERT INTO GUEST (GUESTID,USERID,ROLENUM,PETCATG,PETNAME)
VALUES (#{guestId},#{userId},#{roleNum},#{petCatg},#{petName})
</insert>

<insert id="setBiz" parameterType="MemberDTO">	 
INSERT INTO BIZMEM (BIZNUM,USERID,ROLENUM,ITEMCATG,ITEMID)
VALUES (#{bizNum},#{userId},#{roleNum},#{itemCatg},ITEM_SEQ.NEXTVAL)
</insert>

<select id="getGuestPage" parameterType="MemberDTO" resultMap="myPageResult">
    SELECT M.USERID, M.ROLENUM, R.ROLENAME, M.USERNAME, M.EMAIL, M.PHONE, M.ADDRESS, M.BLOCK, M.AGMAIL, M.AGVALUE, M.AGMES, G.PETCATG, G.PETNAME, MF.FILENAME, MF.ORINAME
      FROM MEMBER M
      INNER JOIN
      GUEST G
      ON M.USERID = G.USERID
      INNER JOIN 
      ROLE R
      ON M.ROLENUM =R.ROLENUM
      
      INNER JOIN
           MEMFILE MF
      ON M.USERID = MF.USERID
WHERE M.USERID=#{userId}
</select>

<select id="getBizPage" parameterType="MemberDTO" resultMap="myPageResult">
SELECT M.USERID, M.ROLENUM, R.ROLENAME, M.USERNAME, M.EMAIL, M.PHONE, M.ADDRESS, M.BLOCK, M.AGMAIL, M.AGVALUE, M.AGMES, B.ITEMCATG, B.ITEMID
      FROM MEMBER M
      INNER JOIN
       ROLE R
      ON M.ROLENUM =R.ROLENUM
      INNER JOIN 
        BIZMEM B
      ON M.USERID = B.USERID
WHERE M.USERID=#{userId}
</select>

<select id="getAdmPage" parameterType="MemberDTO" resultMap="myPageResult">
SELECT M.USERID, M.ROLENUM, R.ROLENAME, M.USERNAME, M.EMAIL, M.PHONE, M.ADDRESS, M.BLOCK, M.AGMAIL, M.AGVALUE, M.AGMES
      FROM MEMBER M
      INNER JOIN
       ROLE R
      ON M.ROLENUM =R.ROLENUM
WHERE M.USERID=#{userId}
</select>

	 	 
<select id="getLogin" parameterType="MemberDTO" resultMap="getLoginResult">
SELECT M.USERNAME, M.USERID, R.ROLENUM, R.ROLENAME
		FROM MEMBER M
    		INNER JOIN
    		ROLE R
    		ON M.ROLENUM = R.ROLENUM
		WHERE M.USERID =#{userId} and M.PASSWORD =#{password}
		ORDER BY R.ROLENUM ASC
</select>

<resultMap type="MemberDTO" id="getLoginResult">
		<id column="USERID" property="userId" />
		<result column="USERNAME" property="userName" />
		<collection property="roleDTO" javaType="RoleDTO" ofType="RoleDTO">
			<id column="ROLENUM" property="roleNum" />
			<result column="ROLENAME" property="roleName" />
		</collection>
	</resultMap>
	
	
<!-- Guest My page Result Map -->
	 <resultMap type="MemberDTO" id="myPageResult">
      <id column="USERID" property="userId"/>
      <result column="ROLENUM" property="roleNum"/>
      <result column="USERNAME" property="userName"/>
      <result column="EMAIL" property="email"/>
      <result column="PHONE" property="phone"/>
      <result column="ADDRESS" property="address"/>
      <result column="BLOCK" property="block"/>
      <result column="AGMES" property="agMes"/>
      <result column="AGVALUE" property="agValue"/>
      <result column="AGMAIL" property="agMail"/>
      <result column="PETCATG" property="petCatg"/>
      <result column="PETNAME" property="petName"/>
      <result column="ITEMCATG" property="itemCatg"/>
      <result column="ITEMID" property="itemId"/>
                              
      <association property="memberFileDTO" javaType="MemberFileDTO">
      <result column="FILENAME" property="fileName"/>
      <result column="ORINAME" property="oriName"/>
      </association>
      
	  <association property="roleDTO" javaType="RoleDTO">
      <result column="ROLENAME" property="roleName"/>
      </association>
      
   </resultMap>
   
   <!-- Bizmem My page Result Map 
	 <resultMap type="MemberDTO" id="GpageResult">
      <id column="USERID" property="userId"/>
      <result column="ROLENUM" property="roleNum"/>
      <result column="USERNAME" property="userName"/>
      <result column="EMAIL" property="email"/>
      <result column="PHONE" property="phone"/>
      <result column="ADDRESS" property="address"/>
      <result column="BLOCK" property="block"/>
      <result column="AGMES" property="agMes"/>
      <result column="AGVALUE" property="agValue"/>
      <result column="AGMAIL" property="agMail"/>
      <result column="ITEMCATG" property="itemCatg"/>
      <result column="ITEMID" property="itemId"/>
      
	  <association property="RoleDTO" javaType="RoleDTO">
      <result column="ROLENAME" property="roleName"/>
      </association>
      
   </resultMap> -->
 
</mapper>